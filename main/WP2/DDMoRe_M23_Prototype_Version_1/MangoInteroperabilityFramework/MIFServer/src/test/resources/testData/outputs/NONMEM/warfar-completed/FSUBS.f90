      MODULE NMPRD4P
      USE SIZES, ONLY: DPSIZE
      USE NMPRD4,ONLY: VRBL
      IMPLICIT NONE
      SAVE
      REAL(KIND=DPSIZE), DIMENSION (:),POINTER ::COM
      REAL(KIND=DPSIZE), POINTER ::TVCL,TVV,TVKA,TVLG,CL,V,KA,ALAG1,S2
      REAL(KIND=DPSIZE), POINTER ::Y,IPRED,A00072,A00074,A00076,A00078
      REAL(KIND=DPSIZE), POINTER ::A00080,A00082,A00084,A00086,A00089
      REAL(KIND=DPSIZE), POINTER ::A00090,D00001,D00002,D00003,D00004
      REAL(KIND=DPSIZE), POINTER ::D00005,D00006,D00007,D00008,D00009
      REAL(KIND=DPSIZE), POINTER ::D00010,D00011,D00012,D00013,D00014
      REAL(KIND=DPSIZE), POINTER ::D00088,D00098,D00097,D00096,D00095
      REAL(KIND=DPSIZE), POINTER ::D00087,D00094,D00093,D00092,D00086
      REAL(KIND=DPSIZE), POINTER ::D00091,D00090,D00085,D00089,C00072
      REAL(KIND=DPSIZE), POINTER ::D00102,D00101,D00100,D00099,C00073
      CONTAINS
      SUBROUTINE ASSOCNMPRD4
      COM=>VRBL
      TVCL=>COM(00001);TVV=>COM(00002);TVKA=>COM(00003)
      TVLG=>COM(00004);CL=>COM(00005);V=>COM(00006);KA=>COM(00007)
      ALAG1=>COM(00008);S2=>COM(00009);Y=>COM(00010);IPRED=>COM(00011)
      A00072=>COM(00012);A00074=>COM(00013);A00076=>COM(00014)
      A00078=>COM(00015);A00080=>COM(00016);A00082=>COM(00017)
      A00084=>COM(00018);A00086=>COM(00019);A00089=>COM(00020)
      A00090=>COM(00021);D00001=>COM(00022);D00002=>COM(00023)
      D00003=>COM(00024);D00004=>COM(00025);D00005=>COM(00026)
      D00006=>COM(00027);D00007=>COM(00028);D00008=>COM(00029)
      D00009=>COM(00030);D00010=>COM(00031);D00011=>COM(00032)
      D00012=>COM(00033);D00013=>COM(00034);D00014=>COM(00035)
      D00088=>COM(00036);D00098=>COM(00037);D00097=>COM(00038)
      D00096=>COM(00039);D00095=>COM(00040);D00087=>COM(00041)
      D00094=>COM(00042);D00093=>COM(00043);D00092=>COM(00044)
      D00086=>COM(00045);D00091=>COM(00046);D00090=>COM(00047)
      D00085=>COM(00048);D00089=>COM(00049);C00072=>COM(00050)
      D00102=>COM(00051);D00101=>COM(00052);D00100=>COM(00053)
      D00099=>COM(00054);C00073=>COM(00055)
      END SUBROUTINE ASSOCNMPRD4
      END MODULE NMPRD4P
      SUBROUTINE PK(ICALL,IDEF,THETA,IREV,EVTREC,NVNT,INDXS,IRGG,GG,NETAS)    
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE NMPRD_REAL,ONLY: ETA,EPS                                            
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV
      USE NMPRD_INT, ONLY: IQUIT
      USE PRCM_INT,  ONLY: MC0000=>PRMC,ME0000=>PRME                          
      USE PRCM_INT,  ONLY: MG0000=>PRMG,MT0000=>PRMT                          
      USE PROCM_INT, ONLY: NEWIND=>PNEWIF                                     
      USE NMBAYES_REAL, ONLY: LDF                                             
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)                                        
      REAL(KIND=DPSIZE) :: EVTREC                                             
      SAVE
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS            
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,71,*)
      IF (ICALL <= 1) THEN                                                    
      CALL ASSOCNMPRD4
      MC0000(1)=30
      ME0000(1)=70
      MG0000(1)=080
      MT0000(1)=70
      IDEF(1,001)= -9
      IDEF(1,002)= -1
      IDEF(1,003)=  0
      IDEF(1,004)=  0
      IDEF(2,003)=  0
      IDEF(2,004)=  0
      IDEF(3,002)=  5
      IDEF(7,001)=  4
      CALL GETETA(ETA)                                                        
      IF (IQUIT == 1) RETURN                                                  
      RETURN                                                                  
      ENDIF                                                                   
      IF (NEWIND /= 2) THEN
       IF (ICALL == 4) THEN
        CALL SIMETA(ETA)
       ELSE
        CALL GETETA(ETA)
       ENDIF
       IF (IQUIT == 1) RETURN
      ENDIF
      WT=EVTREC(NVNT,03)
      TVCL=THETA(01) 
      TVV=THETA(02)*WT/70.D0 
      TVKA=THETA(03) 
      TVLG=THETA(04) 
      B00001=DEXP(ETA(01)) 
      CL=TVCL*B00001 
!                      A00072 = DERIVATIVE OF CL W.R.T. ETA(01)
      A00072=TVCL*B00001 
      B00003=DEXP(ETA(02)) 
      V=TVV*B00003 
!                      A00076 = DERIVATIVE OF V W.R.T. ETA(02)
      A00076=TVV*B00003 
      B00005=DEXP(ETA(03)) 
      KA=TVKA*B00005 
!                      A00080 = DERIVATIVE OF KA W.R.T. ETA(03)
      A00080=TVKA*B00005 
      B00007=DEXP(ETA(04)) 
      ALAG1=TVLG*B00007 
!                      A00084 = DERIVATIVE OF ALAG1 W.R.T. ETA(04)
      A00084=TVLG*B00007 
      S2=V 
!                      A00089 = DERIVATIVE OF S2 W.R.T. ETA(02)
      A00089=A00076 
      GG(01,1,1)=CL    
      GG(01,02,1)=A00072
      GG(02,1,1)=V     
      GG(02,03,1)=A00076
      GG(03,1,1)=KA    
      GG(03,04,1)=A00080
      GG(04,1,1)=ALAG1 
      GG(04,05,1)=A00084
      GG(05,1,1)=S2    
      GG(05,03,1)=A00089
      IF (MSEC == 1) THEN
!                      A00074 = DERIVATIVE OF A00072 W.R.T. ETA(01)
      A00074=TVCL*B00001 
!                      A00078 = DERIVATIVE OF A00076 W.R.T. ETA(02)
      A00078=TVV*B00003 
!                      A00082 = DERIVATIVE OF A00080 W.R.T. ETA(03)
      A00082=TVKA*B00005 
!                      A00086 = DERIVATIVE OF A00084 W.R.T. ETA(04)
      A00086=TVLG*B00007 
!                      A00090 = DERIVATIVE OF A00089 W.R.T. ETA(02)
      A00090=A00078 
      GG(01,02,02)=A00074
      GG(02,03,03)=A00078
      GG(03,04,04)=A00082
      GG(04,05,05)=A00086
      GG(05,03,03)=A00090
      ENDIF
      RETURN
      END
      SUBROUTINE ERROR (ICALL,IDEF,THETA,IREV,EVTREC,NVNT,INDXS,F,G,HH)       
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE NMPRD_REAL,ONLY: ETA,EPS                                            
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,IQUIT
      USE NMPRD_INT, ONLY: NEWL2
      USE PRCM_INT,  ONLY: MC0000=>PRMC,ME0000=>PRME                          
      USE PRCM_INT,  ONLY: MG0000=>PRMG,MT0000=>PRMT                          
      USE PROCM_INT, ONLY: NEWIND=>PNEWIF                                     
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)                                        
      REAL(KIND=DPSIZE) :: EVTREC                                             
      SAVE
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS                       
      DIMENSION :: IDEF(*),THETA(*),EVTREC(IREV,*),INDXS(*),G(70,*)
      DIMENSION :: HH(70,*)
      IF (ICALL <= 1) THEN                                                    
      CALL ASSOCNMPRD4
      MC0000(2)=30
      ME0000(2)=70
      MG0000(2)=080
      MT0000(2)=70
      IDEF(2)=-1
      IDEF(3)=00
      RETURN
      ENDIF
      IF (ICALL == 4) THEN
       IF (NEWL2 == 1) THEN
        CALL SIMEPS(EPS)
        IF (IQUIT == 1) RETURN
       END IF
      ENDIF
      D00001=G(01,1)
      D00002=G(02,1)
      D00003=G(03,1)
      D00004=G(04,1)
      B00001=DEXP(EPS(01)) 
      Y=F*B00001+EPS(02) 
!                      D00085 = DERIVATIVE OF Y W.R.T. ETA(04)
      D00085=B00001*D00004 
!                      D00086 = DERIVATIVE OF Y W.R.T. ETA(03)
      D00086=B00001*D00003 
!                      D00087 = DERIVATIVE OF Y W.R.T. ETA(02)
      D00087=B00001*D00002 
!                      D00088 = DERIVATIVE OF Y W.R.T. ETA(01)
      D00088=B00001*D00001 
!                      C00072 = DERIVATIVE OF Y W.R.T. EPS(01)
      C00072=F*B00001 
!                      C00073 = DERIVATIVE OF Y W.R.T. EPS(02)
      C00073=1.D0 
!                      D00099 = DERIVATIVE OF C00072 W.R.T. ETA(04)
      D00099=B00001*D00004 
!                      D00100 = DERIVATIVE OF C00072 W.R.T. ETA(03)
      D00100=B00001*D00003 
!                      D00101 = DERIVATIVE OF C00072 W.R.T. ETA(02)
      D00101=B00001*D00002 
!                      D00102 = DERIVATIVE OF C00072 W.R.T. ETA(01)
      D00102=B00001*D00001 
      IPRED=F 
      G(01,1)=D00088  
      G(02,1)=D00087  
      G(03,1)=D00086  
      G(04,1)=D00085  
      HH(01,1)=C00072 
      HH(02,1)=C00073 
      HH(01,02)=D00102
      HH(01,03)=D00101
      HH(01,04)=D00100
      HH(01,05)=D00099
      IF (MSEC == 1) THEN
      D00005=G(01,02)
      D00006=G(02,02)
      D00007=G(02,03)
      D00008=G(03,02)
      D00009=G(03,03)
      D00010=G(03,04)
      D00011=G(04,02)
      D00012=G(04,03)
      D00013=G(04,04)
      D00014=G(04,05)
!                      D00089 = DERIVATIVE OF D00085 W.R.T. ETA(04)
      D00089=B00001*D00014 
!                      D00090 = DERIVATIVE OF D00086 W.R.T. ETA(04)
      D00090=B00001*D00013 
!                      D00091 = DERIVATIVE OF D00086 W.R.T. ETA(03)
      D00091=B00001*D00010 
!                      D00092 = DERIVATIVE OF D00087 W.R.T. ETA(04)
      D00092=B00001*D00012 
!                      D00093 = DERIVATIVE OF D00087 W.R.T. ETA(03)
      D00093=B00001*D00009 
!                      D00094 = DERIVATIVE OF D00087 W.R.T. ETA(02)
      D00094=B00001*D00007 
!                      D00095 = DERIVATIVE OF D00088 W.R.T. ETA(04)
      D00095=B00001*D00011 
!                      D00096 = DERIVATIVE OF D00088 W.R.T. ETA(03)
      D00096=B00001*D00008 
!                      D00097 = DERIVATIVE OF D00088 W.R.T. ETA(02)
      D00097=B00001*D00006 
!                      D00098 = DERIVATIVE OF D00088 W.R.T. ETA(01)
      D00098=B00001*D00005 
      G(01,02)=D00098 
      G(02,02)=D00097 
      G(02,03)=D00094 
      G(03,02)=D00096 
      G(03,03)=D00093 
      G(03,04)=D00091 
      G(04,02)=D00095 
      G(04,03)=D00092 
      G(04,04)=D00090 
      G(04,05)=D00089 
      ENDIF
      F=Y
      RETURN
      END
      SUBROUTINE MUMODEL2(THETA,MU_,ICALL,IDEF,NEWIND,&
      EVTREC,DATREC,IREV,NVNT,INDXS,F,G,H,IRGG,GG,NETAS)
      USE NMPRD4P
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE NMPRD_REAL,ONLY: ETA,EPS
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV
      USE NMPRD_INT, ONLY: IQUIT
      USE PRCM_INT,  ONLY: MC0000=>PRMC,ME0000=>PRME
      USE PRCM_INT,  ONLY: MG0000=>PRMG,MT0000=>PRMT
      USE NMBAYES_REAL, ONLY: LDF
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)
      REAL(KIND=DPSIZE)   :: MU_(*)
      INTEGER NEWIND
      REAL(KIND=DPSIZE) :: EVTREC
      SAVE
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,71,*)
       RETURN
       END
