<?xml version="1.0" encoding="UTF-8"?>
<PharmML 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns="http://www.pharmml.org/2013/03/PharmML"
	xsi:schemaLocation="http://www.pharmml.org/2013/03/PharmML http://www.pharmml.org/2013/03/PharmML"
	xmlns:math="http://www.pharmml.org/2013/03/Maths"
	xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes"
	xmlns:ds="http://www.pharmml.org/2013/08/Dataset"
	xmlns:mdef="http://www.pharmml.org/2013/03/ModelDefinition"
	xmlns:mstep="http://www.pharmml.org/2013/03/ModellingSteps"
	xmlns:design="http://www.pharmml.org/2013/03/TrialDesign"
	writtenVersion="0.3.1">

	<ct:Name>Nock_2013_Carboplatin_PK</ct:Name>
	<ct:Description id="id2" > 	  
		Prediction of cytotoxic drug concentrations occurring on the day of autologous stem cell rescue during high-dose chemotherapy regimen
		International Journal of Clinical Pharmacology and Therapeutics, 1/2013, Volume 51, Issue 1, pages:38-40
	</ct:Description>
			
	<IndependentVariable symbId="t"/>
	
	<!-- SYMBOL DEFINITION - RESUIDUAL ERROR MODEL, i.e. combined error model here -->
	<ct:FunctionDefinition symbId="CombinedError2" symbolType="real">
		<ct:FunctionArgument symbId="additive" symbolType="real"/>
		<ct:FunctionArgument symbolType="real" symbId="proportional"/>
		<ct:FunctionArgument symbolType="real" symbId="f"/>
		<ct:Definition>
			<math:Equation>
				<math:Uniop op="sqrt">
					<math:Binop op="plus">
						<math:Binop op="power">
							<ct:SymbRef symbIdRef="additive"/>
							<ct:Real>2</ct:Real>
						</math:Binop>
						<math:Binop op="times">
							<math:Binop op="power">
								<ct:SymbRef symbIdRef="proportional"/>
								<ct:Real>2</ct:Real>
							</math:Binop>
							<math:Binop op="power">
								<ct:SymbRef symbIdRef="f"/>
								<ct:Real>2</ct:Real>
							</math:Binop>
						</math:Binop>
					</math:Binop>
				</math:Uniop>
			</math:Equation>
		</ct:Definition>
	</ct:FunctionDefinition>


	<!-- MODEL DEFINITION -->
	<ModelDefinition xmlns="http://www.pharmml.org/2013/03/ModelDefinition">
		
		<!-- VARIABILITY MODEL -->
		<VariabilityModel blkId="obsError" type="residualError">
			<Level symbId="DV"/>
		</VariabilityModel>
		
		<VariabilityModel blkId="model" type="parameterVariability">
			<Level symbId="ID"/>
		</VariabilityModel>
		
		
		<!-- COVARIATE MODEL -->
		<CovariateModel blkId="c1">
			<Covariate symbId="CLCR">
				<ct:Description> creatinine clearance </ct:Description>
				<Continuous/>					
			</Covariate>
			
			<Covariate symbId="logtCLCR">
				<ct:Description> creatinine clearance log transformed and normalised to median value </ct:Description>
				<Continuous>
					<Transformation>
						<math:Equation>
							<math:Uniop op="log">
								<math:Binop op="divide">
									<ct:SymbRef symbIdRef="CLCR"/>
									<ct:Real>114.48</ct:Real>
								</math:Binop>
							</math:Uniop>
						</math:Equation>
					</Transformation>
				</Continuous>
			</Covariate>

			<Covariate symbId="KG">
				<ct:Description> patient weight</ct:Description>
				<Continuous/>
			</Covariate>
			
			<Covariate symbId="logtKG">
				<ct:Description> weight log transformed and normalised to median value </ct:Description>
				<Continuous>
					<Transformation>
						<math:Equation>
							<math:Uniop op="log">
								<math:Binop op="divide">
									<ct:SymbRef symbIdRef="KG"/>
									<ct:Real>80</ct:Real>
								</math:Binop>
							</math:Uniop>
						</math:Equation>
					</Transformation>
				</Continuous>
			</Covariate>
		</CovariateModel>


		<!-- PARAMETER MODEL -->
		<ParameterModel blkId="pm1">
			
			<!-- Clearence -->
			<SimpleParameter symbId = "THCL"/>
			<SimpleParameter symbId = "CLCLCR_COV"/>			
			<SimpleParameter symbId = "OMCL"/>
			<RandomVariable symbId="eta_OMCL">
				<ct:VariabilityReference>
					<ct:SymbRef blkIdRef="model" symbIdRef="ID"/>
				</ct:VariabilityReference>
				<NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="0.1">
					<mean>
						<rVal>0</rVal>
					</mean>
					<variance>
						<var varId="OMCL"/>
					</variance>
				</NormalDistribution>
			</RandomVariable>
			
			<IndividualParameter symbId="CL">
				<GaussianModel>
					<Transformation>log</Transformation>
					<LinearCovariate>
						<PopulationParameter>
							<ct:Assign>
								<ct:SymbRef symbIdRef="THCL"></ct:SymbRef>
							</ct:Assign>
						</PopulationParameter>
						<Covariate>
							<ct:SymbRef blkIdRef="c1" symbIdRef="logtCLCR"></ct:SymbRef>
							<FixedEffect>
								<ct:SymbRef symbIdRef="CLCLCR_COV"></ct:SymbRef>
							</FixedEffect>
						</Covariate>
					</LinearCovariate>
					<RandomEffects>
						<ct:SymbRef symbIdRef="eta_OMCL"></ct:SymbRef>
					</RandomEffects>
				</GaussianModel>
			</IndividualParameter>

			
			<!-- Volume of distribution in the central compartment -->
			<SimpleParameter symbId = "THV1"/>
			<SimpleParameter symbId = "V1KG_COV"/>			
			<SimpleParameter symbId="V1KG">
				<ct:Assign>
					<Equation xmlns="http://www.pharmml.org/2013/03/Maths">
						<Binop op="power">
							<Binop op="divide">
								<ct:SymbRef blkIdRef="c1" symbIdRef="KG"/>
								<ct:Int>80</ct:Int>
							</Binop>
							<ct:SymbRef symbIdRef="V1KG_COV"/>
						</Binop>
					</Equation>
				</ct:Assign>	
			</SimpleParameter>
			<SimpleParameter symbId="TVV1">
				<ct:Assign>
					<Equation xmlns="http://www.pharmml.org/2013/03/Maths">
						<Binop op="times">
							<ct:SymbRef symbIdRef="THV1"/>
							<ct:SymbRef symbIdRef="V1KG"/>
						</Binop>
					</Equation>
				</ct:Assign>	
			</SimpleParameter>		

			<IndividualParameter symbId="V1">
				<ct:Assign>
					<ct:SymbRef symbIdRef="TVV1"></ct:SymbRef>
				</ct:Assign>
			</IndividualParameter>
			
			<!-- Inter-compartment clearence -->
			<SimpleParameter symbId = "THQ"/>
			<IndividualParameter symbId="Q">
				<ct:Assign>
					<ct:SymbRef symbIdRef="THQ"></ct:SymbRef>
				</ct:Assign>
			</IndividualParameter>
			
			<!-- Volume of distribution in the peripheral compartment -->
			<SimpleParameter symbId = "THV2"/>
			<IndividualParameter symbId="V2">
				<ct:Assign>
					<ct:SymbRef symbIdRef="THV2"></ct:SymbRef>
				</ct:Assign>
			</IndividualParameter>
			
			<!-- residual error parameters in the sd scale -->
			<SimpleParameter symbId = "SDADD"/>
			<SimpleParameter symbId = "SDPROP"/>

			<!-- Volume of distribution in the steady state -->
			<IndividualParameter symbId="VSS">
				<ct:Assign>
					<math:Equation>
						<math:Binop op="plus">
							<ct:SymbRef symbIdRef="V1"/>
							<ct:SymbRef symbIdRef="V2"/>							
						</math:Binop>
					</math:Equation>
				</ct:Assign>	
			</IndividualParameter>
			
			
			<!-- Derived parameters -->
			<IndividualParameter symbId="K">
				<ct:Assign>
					<Equation xmlns="http://www.pharmml.org/2013/03/Maths">
						<Binop op="divide">
							<ct:SymbRef symbIdRef="CL"/>
							<ct:SymbRef symbIdRef="V1"/>
						</Binop>
					</Equation>
				</ct:Assign>	
			</IndividualParameter>
			
			<IndividualParameter symbId="K12">
				<ct:Assign>
					<math:Equation>
						<math:Binop op="divide">
							<ct:SymbRef symbIdRef="Q"/>
							<ct:SymbRef symbIdRef="V1"/>							
						</math:Binop>
					</math:Equation>
				</ct:Assign>
			</IndividualParameter>
			
			<IndividualParameter symbId="K21">
				<ct:Assign>
					<math:Equation>
						<math:Binop op="divide">
							<ct:SymbRef symbIdRef="Q"/>
							<ct:SymbRef symbIdRef="V2"/>							
						</math:Binop>
					</math:Equation>
				</ct:Assign>
			</IndividualParameter>

		</ParameterModel>
		
		
		<!-- STRUCTURAL MODEL -->
		<StructuralModel blkId="sm1">
		
			<!-- Central compartment ODE  -->
			<ct:DerivativeVariable symbId="Ac" symbolType="real">
				<ct:Assign>
					<Equation xmlns="http://www.pharmml.org/2013/03/Maths">
						<Binop op="plus">
							<Binop op="minus">
								<Binop op="times">
									<Uniop op="minus">
										<ct:SymbRef blkIdRef="pm1" symbIdRef="K12"/>
									</Uniop>
									<ct:SymbRef blkIdRef="sm1" symbIdRef="Ac"/>
								</Binop>
								<Binop op="times">
									<ct:SymbRef blkIdRef="pm1" symbIdRef="K"/>
									<ct:SymbRef blkIdRef="sm1" symbIdRef="Ac"/>
								</Binop>
							</Binop>
							<Binop op="times">
								<ct:SymbRef blkIdRef="pm1" symbIdRef="K21"/>
								<ct:SymbRef blkIdRef="sm1" symbIdRef="Ap"/>
							</Binop>
						</Binop>
					</Equation>
				</ct:Assign>
				<ct:IndependentVariable>
					<ct:SymbRef symbIdRef="t"/>
				</ct:IndependentVariable>
				<ct:InitialCondition>
					<ct:InitialValue>
						<ct:Assign>
							<ct:Int>0</ct:Int>
						</ct:Assign>
					</ct:InitialValue>
				</ct:InitialCondition>
			</ct:DerivativeVariable>
			
						
			<!-- Peripheral compartment ODE  -->
			<ct:DerivativeVariable symbId="Ap" symbolType="real">
				<ct:Assign>
					<Equation xmlns="http://www.pharmml.org/2013/03/Maths">
						<Binop op="minus">
							<Binop op="times">
								<ct:SymbRef blkIdRef="pm1" symbIdRef="K12"/>
								<ct:SymbRef blkIdRef="sm1" symbIdRef="Ac"/>
							</Binop>
							<Binop op="times">
								<ct:SymbRef blkIdRef="pm1" symbIdRef="K21"/>
								<ct:SymbRef blkIdRef="sm1" symbIdRef="Ap"/>
							</Binop>
						</Binop>
					</Equation>
				</ct:Assign>
				<ct:IndependentVariable>
					<ct:SymbRef symbIdRef="t"/>
				</ct:IndependentVariable>
				<ct:InitialCondition>
					<ct:InitialValue>
						<ct:Assign>
							<ct:Int>0</ct:Int>
						</ct:Assign>
					</ct:InitialValue>
				</ct:InitialCondition>	
			</ct:DerivativeVariable>


			<!-- Output: Concentration of drug  -->
			<ct:Variable symbolType="real" symbId="IPRED">
				<ct:Assign>
					<Equation xmlns="http://www.pharmml.org/2013/03/Maths">
						<Binop op="divide">
							<ct:SymbRef blkIdRef="sm1" symbIdRef="Ac"/>
							<ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
						</Binop>
					</Equation>
				</ct:Assign>				
			</ct:Variable>
		</StructuralModel>
		
		
		<!-- OBSERVATION MODEL -->
		<ObservationModel blkId="om1">
					
			<SimpleParameter symbId = "SIGMA"/>
			<RandomVariable symbId="eps_SIGMA">
				<ct:VariabilityReference>
					<ct:SymbRef blkIdRef="obsError" symbIdRef="DV"/>
				</ct:VariabilityReference>
				<NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="0.1">
					<mean>
						<rVal>0</rVal>
					</mean>
					<variance>
						<var varId="SIGMA"/>
					</variance>
				</NormalDistribution>
			</RandomVariable>			
			<Standard symbId="Y">
				<Output>
					<ct:SymbRef blkIdRef="om1" symbIdRef="IPRED"/>
				</Output>
				<ErrorModel>
					<ct:Assign>
						<Equation xmlns="http://www.pharmml.org/2013/03/Maths">
							<FunctionCall>
								<ct:SymbRef symbIdRef="CombinedError2"/>
								<FunctionArgument symbId="a">
									<ct:SymbRef blkIdRef="pm1" symbIdRef="SDADD"/>
								</FunctionArgument>
								<FunctionArgument symbId="b">
									<ct:SymbRef blkIdRef="pm1" symbIdRef="SDPROP"/>
								</FunctionArgument>
								<FunctionArgument symbId="f">
									<ct:SymbRef blkIdRef="sm1" symbIdRef="IPRED"/>
								</FunctionArgument>
							</FunctionCall>
						</Equation>
					</ct:Assign>
				</ErrorModel>
				<ResidualError>
					<ct:SymbRef symbIdRef="eps_SIGMA"></ct:SymbRef>
				</ResidualError>
			</Standard>
		</ObservationModel>
		
	</ModelDefinition>
	
	
	<ModellingSteps xmlns="http://www.pharmml.org/2013/03/ModellingSteps">
		<NONMEMdataSet oid="NMdata">
			<ColumnMapping>
				<ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="TIME"/>
				<ct:SymbRef symbIdRef="t"/>
			</ColumnMapping>
			<ColumnMapping>
				<ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="AMT"/>
				<ct:SymbRef blkIdRef="sm1" symbIdRef="Ac"/>
			</ColumnMapping>
			<ColumnMapping>
				<ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="DV"/>
				<ct:SymbRef blkIdRef="om1" symbIdRef="Y"/>
			</ColumnMapping>
			<ColumnMapping>
				<ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="KG"/>
				<ct:SymbRef blkIdRef="c1" symbIdRef="KG"/>
			</ColumnMapping>
			<ColumnMapping>
				<ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="CLCR"/>
				<ct:SymbRef blkIdRef="c1" symbIdRef="CLCR"/>
			</ColumnMapping>
			<DataSet xmlns="http://www.pharmml.org/2013/08/Dataset">
				<Definition>
					<Column columnId="ID" columnType="id" valueType="id" columnNum="1"/>
					<Column columnId="TIME" columnType="idv" valueType="id" columnNum="2"/>
					<Column columnId="TALD" columnType="id" valueType="id" columnNum="3"/>
					<Column columnId="AMT" columnType="dose" valueType="id" columnNum="4"/>
					<Column columnId="DUR" columnType="duration" valueType="id" columnNum="5"/>
					<Column columnId="RATE" columnType="rate" valueType="id" columnNum="6"/>
					<Column columnId="DV" columnType="dv" valueType="id" columnNum="7"/>
					<Column columnId="EVID" columnType="evid" valueType="id" columnNum="8"/>
					<Column columnId="DOSE" columnType="dose" valueType="id" columnNum="9"/>
					<Column columnId="AGE" columnType="covariate" valueType="id" columnNum="10"/>
					<Column columnId="HGT" columnType="covariate" valueType="id" columnNum="11"/>
					<Column columnId="KG" columnType="covariate" valueType="id" columnNum="12"/>
					<Column columnId="BSA" columnType="covariate" valueType="id" columnNum="13"/>
					<Column columnId="CLCR" columnType="covariate" valueType="id" columnNum="14"/>
					<Column columnId="CREA" columnType="covariate" valueType="id" columnNum="15"/>
					<Column columnId="TRT" columnType="covariate" valueType="id" columnNum="16"/>
				</Definition>
				<ImportData oid="NM_dataset">
					<path>Carbo_DDMoRe</path>
					<format>CSV</format>
					<delimiter>COMMA</delimiter>
				</ImportData>
			</DataSet>
		</NONMEMdataSet>
		
		<EstimationStep oid="estTask1">
					
			<!-- Initial parameter estimates -->
			<ParametersToEstimate>
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="THCL"/>
					<InitialEstimate>
						<ct:Real>8.3</ct:Real>
					</InitialEstimate>
					<LowerBound>
						<ct:Int>0</ct:Int>
					</LowerBound>
				</ParameterEstimation>
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="THV1"/>
					<InitialEstimate>
						<ct:Real>22</ct:Real>
					</InitialEstimate>
					<LowerBound>
						<ct:Int>0</ct:Int>
					</LowerBound>
				</ParameterEstimation>
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="THQ"/>
					<InitialEstimate>
						<ct:Real>0.76</ct:Real>
					</InitialEstimate>
					<LowerBound>
						<ct:Int>0</ct:Int>
					</LowerBound>
				</ParameterEstimation>
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="THV2"/>
					<InitialEstimate>
						<ct:Real>31</ct:Real>
					</InitialEstimate>
					<LowerBound>
						<ct:Int>0</ct:Int>
					</LowerBound>
				</ParameterEstimation>
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="SDADD"/>
					<InitialEstimate>
						<ct:Real>0.015</ct:Real>
					</InitialEstimate>
					<LowerBound>
						<ct:Int>0</ct:Int>
					</LowerBound>
				</ParameterEstimation>
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="SDPROP"/>
					<InitialEstimate>
						<ct:Real>0.2</ct:Real>
					</InitialEstimate>
					<LowerBound>
						<ct:Int>0</ct:Int>
					</LowerBound>
				</ParameterEstimation>
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="CLCLCR_COV"/>
					<InitialEstimate>
						<ct:Real>0.69</ct:Real>
					</InitialEstimate>
					<LowerBound>
						<ct:Int>-10</ct:Int>
					</LowerBound>
					<UpperBound>
						<ct:Int>10</ct:Int>
					</UpperBound>
				</ParameterEstimation>
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="V1KG_COV"/>
					<InitialEstimate>
						<ct:Real>0.5</ct:Real>
					</InitialEstimate>
					<LowerBound>
						<ct:Int>-10</ct:Int>
					</LowerBound>
					<UpperBound>
						<ct:Int>10</ct:Int>
					</UpperBound>
				</ParameterEstimation>
				
				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="OMCL"/>
					<InitialEstimate>
						<ct:Real>0.019</ct:Real>
					</InitialEstimate>
				</ParameterEstimation>

				<ParameterEstimation>
					<ct:SymbRef blkIdRef="pm1" symbIdRef="SIGMA"/>
					<InitialEstimate fixed="true">
						<ct:Real>1</ct:Real>
					</InitialEstimate>
				</ParameterEstimation>
				
			</ParametersToEstimate>

			<Operation order="1" opType="estPop"/>
			<Operation order="2" opType="estIndiv"/>

		</EstimationStep>
		
		<!-- STEP DEPENDENCIES -->
		<StepDependencies>
			<Step>
				<ct:OidRef oidRef="estTask1"/>
			</Step>
		</StepDependencies>
			

	</ModellingSteps>		
</PharmML>