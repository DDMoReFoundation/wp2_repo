# nt2mdl 1.022 beta Nick Holford n.holford@auckland.ac.nz
CCR2012_TGI_dat = dataobj{
   DATA_INPUT_VARIABLES{
      ID=list(type=categorical)
      TIME=list(type=continuous)
      AMT=list(type=continuous)
      DV=list(type=continuous)
   }# end HEADER

   FILE{
      data=list(
           source="mydata.csv",
           inputformat="NONMEM")
   }# end FILE
} # end data object
 
CCR2012_TGI_par = parobj{

   STRUCTURAL{
      POP_PT0=list(value=7.13) # mm
      POP_Q0=list(value=41.2) # mm
      POP_LAMBDAP=list(value=0.121) # mo-1
      POP_KPQ=list(value=0.0295) # mo-1
      POP_KQPP=list(value=0.0031) # mo-1
      POP_DELTAQP=list(value=0.00867) # mo-1
      POP_GAMA=list(value=0.729)
      POP_KDE=list(value=0.24) # mo-1
      RUV_SD=list(value=1,lo=0) # mm (No estimate reported in CCR2012)
   }# end STRUCTURAL

   VARIABILITY{
      PPV_PT0=list(value=0.884 ,type="VAR")
      PPV_Q0=list(value=0.292 ,type="VAR")
      PPV_LAMBDAP=list(value=0.518 ,type="VAR")
      PPV_KPQ=list(value=0.578 ,type="VAR")
      PPV_KQPP=list(value=0.941 ,type="VAR")
      PPV_DELTAQP=list(value=0.563 ,type="VAR")
      PPV_GAMA=list(value=1.323 ,type="VAR")
      PPV_KDE=list(value=0.490 ,type="VAR",fix=true)
      RUV_EPS1=list(value=1 ,type="VAR",fix=true)

   }# end VARIABILITY

} # end of parameter object

CCR2012_TGI_mdl = mdlobj{

   MODEL_INPUT_VARIABLES{
      ID=list(use=id, level=2)
      TIME=list(use=idv, units="h")
      AMT=list(use=amt)
      DV=list(type=continuous, use=dv, level=1)
   }# end INPUT_VARIABLES

   STRUCTURAL_PARAMETERS{
      POP_PT0
      POP_Q0
      POP_LAMBDAP
      POP_KPQ
      POP_KQPP
      POP_DELTAQP
      POP_GAMA
      POP_KDE
      RUV_SD
   }# end STRUCTURAL_PARAMETERS

   VARIABILITY_PARAMETERS{
      PPV_PT0
      PPV_Q0
      PPV_LAMBDAP
      PPV_KPQ
      PPV_KQPP
      PPV_DELTAQP
      PPV_GAMA
      PPV_KDE
      RUV_EPS1
   }# end VARIABILITY_PARAMETERS


   RANDOM_VARIABLE_DEFINITION{
      eta_PPV_PT0 ~ (type=Normal, mean=0, variance=PPV_PT0,level=ID)
      eta_PPV_Q0 ~ (type=Normal, mean=0, variance=PPV_Q0,level=ID)
      eta_PPV_LAMBDAP ~ (type=Normal, mean=0, variance=PPV_LAMBDAP,level=ID)
      eta_PPV_KPQ ~ (type=Normal, mean=0, variance=PPV_KPQ,level=ID)
      eta_PPV_KQPP ~ (type=Normal, mean=0, variance=PPV_KQPP,level=ID)
      eta_PPV_DELTAQP ~ (type=Normal, mean=0, variance=PPV_DELTAQP,level=ID)
      eta_PPV_GAMA ~ (type=Normal, mean=0, variance=PPV_GAMA,level=ID)
      eta_PPV_KDE ~ (type=Normal, mean=0, variance=PPV_KDE,level=ID)
      eps_RUV_EPS1 ~ (type=Normal, mean=0, variance=RUV_EPS1,level=DV)
   }# end RANDOM_VARIABLE_DEFINITION

   INDIVIDUAL_VARIABLES{
      PT0=POP_PT0*exp(eta_PPV_PT0)
      Q0=POP_Q0*exp(eta_PPV_Q0)
      LAMBDAP=POP_LAMBDAP*exp(eta_PPV_LAMBDAP)
      KPQ=POP_KPQ*exp(eta_PPV_KPQ)
      KQPP=POP_KQPP*exp(eta_PPV_KQPP)
      DELTAQP=POP_DELTAQP*exp(eta_PPV_DELTAQP)
      GAMA=POP_GAMA*exp(eta_PPV_GAMA)
      KDE=POP_KDE*exp(eta_PPV_KDE)
      K=100
   #Initial conditions
   }# end INDIVIDUAL_VARIABLES

   MODEL_PREDICTION{
      param=list(PT0,Q0,LAMBDAP,KPQ,KQPP,DELTAQP,GAMA,KDE,K,PSTAR,C,PT,Q,QP,DPSTAR)

   ODE{
      DPSTAR=PT+Q+QP
      C=ode(deriv= -KDE*C ,init=0,wrt=TIME) # conc in KPD effect compartment
      PT=ode(deriv= LAMBDAP*PT*(1-DPSTAR/K) + KQPP*QP - KPQ*PT - GAMA*PT*KDE*C ,init=PT0,wrt=TIME) # proliferating cells
      Q=ode(deriv= KPQ*PT - GAMA*Q*KDE*C ,init=Q0,wrt=TIME) # quiescent cells
      QP=ode(deriv= GAMA*Q*KDE*C - KQPP*QP - DELTAQP*QP ,init=0,wrt=TIME) # damage quiescent cells
   }# end ODE

   LIBRARY{
      amount=nmadvan(model=13,ncmt=4)
   }# end LIBRARY
   
      PSTAR=PT+Q+QP
   }# end MODEL_PREDICTION

   OBSERVATION{
      Y = PSTAR+ RUV_SD*eps_RUV_EPS1
   }# end OBSERVATION


   MODEL_OUTPUT_VARIABLES{
      ID
      TIME
      Y
   }# end OUTPUT_VARIABLES

} # end of model object

CCR2012_TGI_task = taskobj{

   MODEL{
      tolrel=9
   }# end MODEL

TARGET_CODE(target = NMTRAN_CODE, location="$PROBLEM", first=true){***
$PROB CCR2012 RIBBA TUMOUR GROWTH INHIBITION
***
}# end TARGET_CODE

   myEST=function(t,m,p,d) { 
   #   EXECUTE {
   #      command="call nmgo CCR2012_TGI"
   #   }# end EXECUTE

      ESTIMATE {
         target=t
         model=m
         parameter=p
         data=d
TARGET_CODE(target = NMTRAN_CODE, location="$ESTIMATION"){***
$EST METHOD=COND
MAXEVAL=9990 NSIG=3 SIGL=9 NOABORT PRINT=1
***
}# end TARGET_CODE
            algo=list("FOCE ")
            max=9990
            sig=3
         }

   }# end of myEST

}# end of task object

CCR2012_TGI_tel = telobj{

CCR2012_TGI_fit=CCR2012_TGI_task$myEST(t="NONMEM", m=CCR2012_TGI_mdl, p=CCR2012_TGI_par, d=CCR2012_TGI_dat)

CCR2012_TGI_par=update(CCR2012_TGI_fit,CCR2012_TGI_par)

} # end of task execution language code
